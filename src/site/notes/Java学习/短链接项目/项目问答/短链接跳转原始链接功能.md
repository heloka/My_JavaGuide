---
{"dg-publish":true,"permalink":"/Java学习/短链接项目/项目问答/短链接跳转原始链接功能/"}
---

resToUrl函数设计逻辑
首先传入参数应该是前端规定的。

一个短网址可以在多个域名里使用？是什么意思？域名应该就是服务器地址-备案用的
更新短链接请求里面就有requestParam

![Pasted image 20240304140140.png](/img/user/image/Pasted%20image%2020240304140140.png)

但是restoUri没有传入requestParam，用户只能传递shortUrl

比如：
![Pasted image 20240304140350.png](/img/user/image/Pasted%20image%2020240304140350.png)

难道不能读取前端页面，然后看该短链接在哪个分组下面吗？
答案是不能，毕竟只有负责创建短链接的人才知道分组，而普通点击短链接的用户是不关心这些底层的存在的，我们就是需要通过短链接shortUrl找到它的分组。
- 引入路由表，shortUrl-》 在路由表查找对应的gid，然后再根据补充的gid找到原始网址

- 好像短链接加入了时间戳的，可以防止重复。


仔细想想，如果只有shortUrl，能不能查到对应的数据？
- 答案是不能，应为我们使用了 gid 作为分片键，查询时必须带上，否则读扩散（理论上不带也行？只是性能不好？）

**大佬解答：**
理了一下短链接项目得库表结构，分表的时候，分片键是什么？以及为什么选择这个字段作为分片键？
**t_user**：用户表是根据 **username** 作为分片键的，因为用户登录的时候是根据用户名和密码进行登录的，所以查询 t_user 用户表的时候，在 where 中会加上 username 的条件，所以要使用 username 作为分片键，不然的话就会造成读扩散的问题，需要扫描每一张用户表了，这样肯定是不能够接受的
**t_group**：分组表也是根据 **username** 作为分片键的，因为我们需要实现查询属于某一个用户的所有分组的集合，所以同理要使用 username 作为分片键
**t_link**：短链接表是根据 **gid 分组标识**作为分片键的，这是因为我们需要查询属于某一分组下面的所有短链接，那么就会有一个问题，在实现短链接跳转到原始连接功能的时候，需要根据 full_short_url 找到原始的链接，这时候怎么办呢？**t_link 是使用 gid 分组标志作为分片键的，那么查询的时候一定要携带上 gid**，这时候就引入了下面要讲的路由表了
**t_link_goto**：这是通过 `full_short_url` 获取 gid 的一个路由表，goto 表是根据 `full_short_url` 作为分片键的，在实现短链接跳转到原始连接功能的时候，需要根据 `full_short_url` 和Gid 找到原始的链接
{ #2m3g20}



