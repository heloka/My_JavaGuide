---
{"dg-publish":true,"permalink":"/Java学习/短链接项目/项目问答/短链接-项目中短链接缓存预热是怎么做的？/"}
---

PS: 这也叫缓存预热吗，在新增数据的时候把数据放入缓存，这不是传统艺能吗。
## 什么是缓存预热？  
缓存预热是指在应用程序启动或系统负载低峰期，**提前将应用程序需要访问缓存的数据加载到缓存中**，以便在实际的请求到来时能够快速响应。  
缓存预热的目的是避免在实际请求到来时由于缓存冷启动而导致的延迟或性能下降。缓存冷启动是指在缓存中没有预先加载数据的情况下，第一次请求到达时需要从后端系统或数据库获取数据，并将其存储到缓存中。这个过程可能需要花费较长的时间，延迟了实际请求的响应时间。  

### 1缓存击穿问题  
如果一个短链接创建后有大量用户访问（创建出来后第一时间同时访问），如果缓存中还没有该短链接，那么就可能会造成缓存击穿问题。  
缓存击穿指在高并发的系统中，一个热点数据缓存**过期或者在缓存中不存在**，导致大量并发请求直接访问数据库，从而给数据库造成巨大压力，甚至可能引起宕机。  
具体来说，当某个热点数据在缓存中过期时，如果此时有大量并发请求同时访问这个数据，由于缓存中不存在，所有请求都会直接访问数据库，导致数据库负载急剧增加。  

![image/2c48c0cbb54d649c310710150a677f12_MD5.webp](/img/user/image/2c48c0cbb54d649c310710150a677f12_MD5.webp)

**缓存预热**就是解决缓存击穿的一种有效解决方案。  

### 2缓存预热优势  
通过缓存预热，可以在创建短链接后，提前加载缓存中的数据。这样，在实际请求到来时，数据已经存在于缓存中，可以立即从缓存中获取，大大提高了响应速度和系统的整体性能，减少后续请求的延迟。
## 如何进行缓存预热？  
缓存预热有很多种方式，比如定时任务从数据库中查询进行预热等。我们这里在创建完短链接后就将短链接记录新增到缓存中。
```java
// 将短链接新增到缓存中进行预热
stringRedisTemplate.opsForValue().set(
String.format(GOTO_SHORT_LINK_KEY, fullShortUrl),
requestParam.getOriginUrl(),
LinkUtil.getLinkCacheValidTime(requestParam.getValidDate()), TimeUnit.MILLISECONDS);
shortUriCreateCachePenetrationBloomFilter.add(fullShortUrl);
);
```

### 设置缓存的过期时间
缓存预热的话，有个小技巧，是否要设置缓存的过期时间？如果设置，那设置多少合适？  
因为咱们短链接创建时是可以设置过期时间的，所以对于设置了过期时间的短链接，我们在缓存中也设置对应的时间即可。
![image/Pasted image 20240328190720.png](/img/user/image/Pasted%20image%2020240328190720.png)
那对于永久有效的短链接难道就不设置过期时间么？大家知道，短链接一般来说具有时效性，很多时候只会在一定时间内使用，过了这个时间后，用的人就很少了。所以，**即使短链接永久有效，我们也得设置过期时间**。不然，大量不使用的短链接放在缓存中，存储压力会比较大。  
如果短链接设置的永久有效，我们默认一个月的过期时间。如果一个月后还有人访问，再去数据库加载数据，再设置一个月的过期时间即可。