---
{"dg-publish":true,"permalink":"/Java学习/短链接项目/项目问答/短链接-短链接是如何跳转长链接？/"}
---

## 短链接跳转业务  
大多短链接系统短链接跳转逻辑应该是这样的：用户通过浏览器输入短链接访问，**通过短链接获取到原始链接并进行跳转**。  
看着虽然只有两句话，但是里边的弯弯绕绕可不少，跟着解读一起看下去。  

## 获取原始链接  
通过短链接获取到原始连接的过程大致如下
1. 通过短链接缓存获取对应的原始连接；  
2. 如果原始连接缓存失效则需要通过数据库进行查询并再放入缓存；  
3. 首先通过短链接查询 **t_link_goto** 表获取 Gid，再通过 Gid 和短链接查询 t_link 中的原始链接。  

### 1为什么需要 t_link_goto？  
首先，根据分库分表 ShardingSphere 的运行理念，**分表后的数据查询需要分片键**，否则会有[[Java学习/短链接项目/项目问答/短链接-数据库分片键是如何考虑的？#读扩散\|读扩散问题]]。  
因为短链接表使用的是 Gid 进行分表，用户通过浏览器访问短链接时，仅有短链接网址，没有 Gid，所以我们需要建立一个路由表，也就是 t_link_goto，来缓存短链接（fullShortUrl）和 Gid 的关系。  

为什么 **t_link 表**不以短链接作为分片键呢，参考如下：
[[Java学习/短链接项目/项目问答/短链接-数据库分片键是如何考虑的？\|短链接-数据库分片键是如何考虑的？]]

### 2短链接过期或者不存在怎么办？  
如果短链接过期或者不存在是不能访问的，并且要跳转到对应的链接不存在页面。如下图：  
![image/91a69fc8a7bafdceb17a291cd0d76697_MD5.webp](/img/user/image/91a69fc8a7bafdceb17a291cd0d76697_MD5.webp)

详情查看【SaaS 短链接@短链接管理】相关视频学习。  

## HTTP 重定向  
获取到短链接对应的原始链接后，需要对用户访问浏览器进行 HTTP 请求重定向。那什么是 HTTP 请求重定向？  
HTTP 重定向用白话文解释就是，你访问 [http://nurl.ink:8003/4V3fts](http://nurl.ink:8003/4V3fts) 我给你转发到另外一个网站上。  

![image/268c5ccec893d66a897e45c6d085b5a8_MD5.webp](/img/user/image/268c5ccec893d66a897e45c6d085b5a8_MD5.webp)

  
可以看到 HTTP 的状态码是 302，这个有什么讲究呢？一般以 3xx 开头的代表重定向，表示网页发生了转移，需要重定向到对应的地址中去，两者区别是：  
- 301：**表示永久性转移**。会导致搜索引擎将旧的URL替换为新的 URL，并且浏览器会缓存新的 URL。对于后续的请求，浏览器会直接使用新的 URL 进行访问，而不会再发送请求到旧的 URL。  
- 302：**表示临时性转移**。不会导致搜索引擎更新索引，它只是暂时重定向到新的 URL。浏览器会缓存新的 URL，但对于后续的请求，浏览器会**继续发送请求到原始的 URL**，而不是直接使用新的 URL。  
简单来说，通过 301 跳转，只会在访问一次后端请求，然后就被缓存到浏览器，后续就直接从浏览器拿，不需要再访问短链接服务了。  
302 跳转，每次都需要去短链接服务获取最新的链接，再进行重定向，浏览器不缓存相关信息。  
两者优缺点：  
- 301：优点对短链接后端服务压力比较小。缺点是后续短链接变更了原始链接，无法感知；以及**无法记录详细的统计信息**。  
- 302：上边的缺点就是优点。缺点是每次访问后端服务器，可能压力会大一些，但是相对于获取到用户的行为，这种小缺点都是能接受的。  

```java
((HttpServletResponse) response).sendRedirect(shortLinkDO.getOriginUrl());
```